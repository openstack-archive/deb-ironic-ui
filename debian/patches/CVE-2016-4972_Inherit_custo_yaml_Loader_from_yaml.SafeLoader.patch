Description: Inherit custom yaml Loader from yaml.SafeLoader
 Before this patch yaql-enabled yaml Loader was inherited from yaml.Loader, that
 potentially allows creating arbitrary python objects from specifically
 formatted yaml tags. This could have happened whenever UI definitions of
 the package were processed.
 With this change yaql yaml-Loader no longer allows creating custom python objects.
Author: Kirill Zaitsev <kzaitsev@mirantis.com>
Date: Thu, 26 May 2016 21:11:28 +0000 (+0300)
X-Git-Tag: 2.0.1^0
X-Git-Url: https://review.openstack.org/gitweb?p=openstack%2Fmurano-dashboard.git;a=commitdiff_plain;h=338989020cfd2f4b16a71f7da9a788d668502c9e
Change-Id: I4fe38aa7e0fc567211ab872c7e1f8e81dbc3e765
Bug-Ubuntu: https://launchpad.net/bugs/1586079
Bug-Debian: https://bugs.debian.org/828064
Origin: upstream, https://review.openstack.org/#/c/333439/
Last-Update: 2016-06-27

diff --git a/muranodashboard/api/packages.py b/muranodashboard/api/packages.py
index 95820e7..b187b87 100644
--- a/muranodashboard/api/packages.py
+++ b/muranodashboard/api/packages.py
@@ -63,7 +63,7 @@ def app_by_fqn(request, fqn, catalog=True):
 
 
 def make_loader_cls():
-    class Loader(yaml.Loader):
+    class Loader(yaml.SafeLoader):
         pass
 
     def yaql_constructor(loader, node):
@@ -72,7 +72,7 @@ def make_loader_cls():
 
     # workaround for PyYAML bug: http://pyyaml.org/ticket/221
     resolvers = {}
-    for k, v in yaml.Loader.yaml_implicit_resolvers.items():
+    for k, v in yaml.SafeLoader.yaml_implicit_resolvers.items():
         resolvers[k] = v[:]
     Loader.yaml_implicit_resolvers = resolvers
 
diff --git a/releasenotes/notes/safeloader-cve-2016-4972-82523879a6c3b1a5.yaml b/releasenotes/notes/safeloader-cve-2016-4972-82523879a6c3b1a5.yaml
new file mode 100644
index 0000000..f022c5c
--- /dev/null
+++ b/releasenotes/notes/safeloader-cve-2016-4972-82523879a6c3b1a5.yaml
@@ -0,0 +1,9 @@
+---
+security:
+  - cve-2016-4972 has been addressed. In ceveral places
+    Murano used loaders inherited directly from yaml.Loader
+    when parsing MuranoPL and UI files from packages.
+    This is unsafe, because this loader is capable of creating
+    custom python objects from specifically constructed
+    yaml files. With this change all yaml loading operations are done
+    using safe loaders instead.
